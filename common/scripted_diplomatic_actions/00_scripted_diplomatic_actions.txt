# Author(s): AngriestBird
scripted_diplomatic_actions = {
	##Yard1's Recall Volunteers mod integrated :D
	recall_volunteers = {
		allowed = {
			ROOT = { is_ai = no }
		}

		visible = {
			has_global_flag = allowed_recall_volunteers
		}

		selectable = {
			# doing this for nicer tooltips
			if = {
				limit = {
					NOT = { has_volunteers_amount_from = { tag = ROOT count > 0 } }
				}
				custom_trigger_tooltip = {
					tooltip = RECALL_VOLUNTEERS_TOOLTIP
					always = no
				}
			}
			else = {
				custom_trigger_tooltip = {
					tooltip = RECALL_VOLUNTEERS_TOOLTIP_G
					always = yes
				}
			}
		}

		cost = 50
		command_power = 15

		requires_acceptance = no
		show_acceptance_on_action_button = no

		icon = 1

		send_description = RECALL_VOLUNTEERS_SEND_DESC

		complete_effect = {
			ROOT = { recall_volunteers_from = PREV }
		}
	}

	# Trade Agreements
	propose_improved_trade_agreement = {
		allowed = { always = yes }
		visible = {
			THIS = {
				NOT = { has_country_flag = trade_agreement@ROOT }
			}
		}
		selectable = {
			custom_trigger_tooltip = {
				tooltip = PROPOSE_TRADE_AGREEMENT_TOOLTIP
				THIS = {
					NOT = { has_country_flag = trade_agreement@ROOT }
				}
			}
			THIS = {
				if = {
					limit = {
						ROOT = { NOT = { has_idea = EU_member } }
						THIS = { tag = SWI }
					}
					NOT = { has_war_with = ROOT }
					has_opinion = { target = ROOT value > 50 }
				}
				else = {
					NOT = { has_war_with = ROOT }
					has_opinion = { target = ROOT value > 10 }
				}
				if = { limit = { is_in_faction = yes }
					# Do not ally your enemies friends
					any_allied_country = {
						NOT = { has_war_with = ROOT }
					}
				}
			}
		}
		cost = 50
		requires_acceptance = yes
		show_acceptance_on_action_button = yes
		icon = 17
		send_description = PROPOSE_TRADE_AGREEMENT_DESC

		on_sent_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action on_sent_effect propose_improved_trade_agreement"
			ROOT = { set_variable = { pending_trade_offer_country = PREV.id } }
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action complete_effect propose_improved_trade_agreement"
			set_country_flag = trade_agreement@ROOT
			ROOT = {
				clear_variable = pending_trade_offer_country
				set_country_flag = trade_agreement@PREV
			}
			THIS = {
				add_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				add_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				reverse_add_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				reverse_add_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				set_temp_variable = { percent_change = 1 }
				set_temp_variable = { tag_index = ROOT.id }
				set_temp_variable = { influence_target = THIS.id }
				change_influence_percentage = yes
				add_to_variable = { signed_trade_agreements = 1 }
				ROOT = {
					set_temp_variable = { percent_change = 1 }
					set_temp_variable = { tag_index = PREV.id }
					set_temp_variable = { influence_target = THIS.id }
					change_influence_percentage = yes
					recalculate_influence = yes
					add_to_variable = { signed_trade_agreements = 1 }

					if = {
						limit = { ROOT = { original_tag = SIN } }
						SIN_calculate_singaporean_trade_agreements = yes
					}
				}
			}
		}
		reject_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action complete_effect propose_improved_trade_agreement"
			ROOT = {
				clear_variable = pending_trade_offer_country
			}
			THIS = {
				add_opinion_modifier = { target = ROOT modifier = reject_trade_agreement }
				reverse_add_opinion_modifier = { target = ROOT modifier = reject_trade_agreement }
			}
		}

		accept_title = PROPOSE_TRADE_AGREEMENT_ACCEPT_TT
		accept_description = PROPOSE_TRADE_AGREEMENT_ACCEPT_DESC
		reject_title = PROPOSE_TRADE_AGREEMENT_REJECT_TT
		reject_description = PROPOSE_TRADE_AGREEMENT_REJECT_DESC

		ai_acceptance = {
			base_trade_condition = {
				base = -25
				modifier = {
					ROOT = { has_country_flag = italy_china_trade_deal }
					THIS = { has_country_flag = italy_china_trade_deal }
					add = 50
				}
			}
			condition_two = {
				base = 0
				modifier = {
					add = 5
					is_same_government_THIS_ROOT = yes
				}
				modifier = {
					add = -50
					THIS = { has_government = nationalist }
				}
			}
			condition_three = {
				base = 0
				modifier = {
					add = -10
					THIS = { has_opinion = { target = ROOT value < 0 } }
					THIS = { has_opinion = { target = ROOT value > -25 } }
				}
				modifier = {
					add = -15
					THIS = { has_opinion = { target = ROOT value < -24 } }
					THIS = { has_opinion = { target = ROOT value > -50 } }
				}
				modifier = {
					add = -20
					THIS = { has_opinion = { target = ROOT value < -49 } }
					THIS = { has_opinion = { target = ROOT value > -100 } }
				}
				modifier = {
					add = -30
					THIS = { has_opinion = { target = ROOT value < -99 } }
					THIS = { has_opinion = { target = ROOT value > -150 } }
				}
				modifier = {
					add = -50
					THIS = { has_opinion = { target = ROOT value < -150 } }
				}
				modifier = {
					add = 5
					THIS = { has_opinion = { target = ROOT value > 0 } }
					THIS = { has_opinion = { target = ROOT value < 25 } }
				}
				modifier = {
					add = 10
					THIS = { has_opinion = { target = ROOT value > 24 } }
					THIS = { has_opinion = { target = ROOT value < 50 } }
				}
				modifier = {
					add = 15
					THIS = { has_opinion = { target = ROOT value > 49 } }
					THIS = { has_opinion = { target = ROOT value < 100 } }
				}
				modifier = {
					add = 25
					THIS = { has_opinion = { target = ROOT value > 99 } }
					THIS = { has_opinion = { target = ROOT value < 150 } }
				}
				modifier = {
					add = 30
					THIS = { has_opinion = { target = ROOT value > 149 } }
				}
			}
			condition_four = {
				base = 0
				modifier = {
					ROOT = { has_idea = NATO_member }
					THIS = { has_idea = NATO_member }
					add = 10
				}
			}
			condition_five = {
				base = 0
				modifier = {
					THIS = {
						OR = {
							has_idea = EU_member
							tag = SWI
						}
					}
					ROOT = { has_idea = EU_member }
					add = 15
				}
			}
			condition_six = {
				base = 0
				modifier = {
					ROOT = { is_in_faction_with = PREV }
					add = 10
				}
			}
			condition_seven = {
				base = 0
				modifier = {
					add = 10
					is_subject_of = ROOT
				}
			}
			condition_eight = {
				base = 0
				modifier = {
					add = 10
					is_influencer = yes
				}
			}
		}

		ai_desire = {
			base = 25
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 0 } }
				add = 2
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 25 } }
				add = 5
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 50 } }
				add = 5
			}
			modifier = {
				ROOT = { original_tag = SOV }
				THIS = { has_idea = NATO_member }
				add = -5
			}
			modifier = {
				ROOT = { is_in_faction_with = PREV }
				add = 2
			}
			modifier = {
				ROOT = { has_idea = EU_member }
				THIS = { has_idea = EU_member }
				add = 2
			}
			modifier = {
				ROOT = { has_idea = NATO_member }
				THIS = { has_idea = NATO_member }
				add = 2
			}
			modifier = {
				ROOT = { is_guaranteed_by = PREV }
				add = 1
			}
			modifier = {
				add = 5
				is_subject_of = ROOT
			}
			modifier = {
				add = 5
				is_influencer = yes
			}
			modifier = {
				add = 5
				is_top3_influencer = yes
			}
			modifier = {
				OR = {
					AND = {
						ROOT = { tag = CHI }
						THIS = { tag = USA }
					}
					AND = {
						ROOT = { tag = USA }
						THIS = { tag = CHI }
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = KOR }
					}
					AND = {
						ROOT = { tag = KOR }
						THIS = { tag = NKO }
					}
					AND = {
						ROOT = { tag = JAP }
						THIS = { tag = NKO }
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = JAP }
					}
				}
				factor = 0
			}
			modifier = {
				ROOT = {
					OR = {
						any_enemy_country = {
							is_in_faction_with = PREV.PREV
						}
						any_allied_country = {
							has_war_with = PREV.PREV
						}
					}
				}
				factor = 0
			}
			modifier = {
				factor = 1.10
				ROOT = { has_political_power > 499 }
			}
			modifier = {
				factor = 0.50
				ROOT = { has_political_power < 450 }
			}
			modifier = {
				factor = 0
				ROOT = { has_political_power < 250 }
			}
			modifier = {
				factor = 0
				ROOT = {
					NOT = { check_variable = { pending_trade_offer_country = 0 } }
				}
			}
		}
	}

	cancel_trade_agreement = {
		allowed = { always = yes }
		visible = { THIS = { has_country_flag = trade_agreement@ROOT } }
		selectable = {
			custom_trigger_tooltip = {
				tooltip = CANCEL_TRADE_AGREEMENT_TOOLTIP
				THIS = { has_country_flag = trade_agreement@ROOT }
			}
		}
		cost = 50
		can_be_sent = { always = yes }
		show_acceptance_on_action_button = no
		requires_acceptance = no
		icon = 17
		send_description = CANCEL_TRADE_AGREEMENT_DESC

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action cancel_trade_agreement"
			THIS = {
				remove_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				remove_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				clr_country_flag = trade_agreement@ROOT
				add_to_variable = { signed_trade_agreements = -1 }
				ROOT = {
					remove_opinion_modifier = { target = PREV modifier = mutual_trade_agreement }
					remove_opinion_modifier = { target = PREV modifier = mutual_trade_opinion }
					add_opinion_modifier = { target = PREV modifier = broke_trade_agreement }
					clr_country_flag = trade_agreement@PREV
					add_to_variable = { signed_trade_agreements = -1 }
					if = {
						limit = { ROOT = { original_tag = SIN } }
						SIN_calculate_singaporean_trade_agreements = yes
					}
				}
				add_opinion_modifier = { target = ROOT modifier = broke_trade_agreement }
			}
		}

		ai_desire = {
			base = 1
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < 0 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -25 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -50 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -75 }
				}
				add = 100
			}
			modifier = {
				ROOT = {
					any_enemy_country = { is_in_faction_with = PREV.PREV }
				}
				add = 100
			}
			modifier = {
				ROOT = { has_war_with = PREV }
				add = 100
			}
		}
	}

	# Assume Debt
	diplo_action_assume_debt = {
		allowed = { always = yes }
		selectable = {
			#selected country has lower GDP/C than us
			custom_trigger_tooltip = {
				tooltip = gdp_greater_than_other
				check_variable = { gdp_per_capita < ROOT.gdp_per_capita }
			}
			gdp_debt_ratio_higher_25 = yes
			ROOT = {
				gdp_debt_ratio_lower_75 = yes
			}
			NOT = { has_war_with = ROOT }
			THIS = {
				has_opinion = { target = ROOT value > 49 }
			}
			if = {
				limit = { is_in_faction = yes }
				any_allied_country = {
					NOT = { has_war_with = ROOT }
				}
			}
			THIS = {
				custom_trigger_tooltip = {
					set_temp_variable = { tmp = debt }
					multiply_temp_variable = { tmp = 0.25 }
					tooltip = treasury_more_than_25_debt_tt
				}
			}
		}

		cost = 50
		requires_acceptance = yes
		show_acceptance_on_action_button = yes
		icon = 19
		send_description = DIPLO_ACTION_ASSUME_DEBT_DESC

		on_sent_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action on_sent_effect diplo_action_assume_debt"
			set_variable = { ROOT.assuming_debt_value = THIS.debt }
			multiply_variable = { ROOT.assuming_debt_value = 0.25 }

			ROOT = {
				set_variable = { pending_assume_debt_offer = PREV.id }
				set_country_flag = pending_assume_debt@PREV
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action complete_effect diplo_action_assume_debt"
			ROOT = {
				clear_variable = pending_assume_debt_offer
				subtract_from_variable = { treasury = assuming_debt_value }
				ingame_update_setup = yes
			}
			THIS = {
				subtract_from_variable = { debt = ROOT.assuming_debt_value }
				ingame_update_setup = yes
			}
			ROOT = {
				clear_variable = assuming_debt_value
			}
		}
		reject_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action reject_effect diplo_action_assume_debt"
			ROOT = {
				clear_variable = pending_assume_debt_offer
				clear_variable = assuming_debt_value
			}
			THIS = {
				add_opinion_modifier = { target = ROOT modifier = reject_assuming_debt }
				reverse_add_opinion_modifier = { target = ROOT modifier = reject_assuming_debt }
			}
		}

		accept_title = DIPLO_ACTION_ASSUME_DEBT_ACCEPT
		accept_description = DIPLO_ACTION_ASSUME_DEBT_ACCEPT_DESC
		reject_title = DIPLO_ACTION_ASSUME_DEBT_REJECT
		reject_description = DIPLO_ACTION_ASSUME_DEBT_REJECT_DESC

		ai_acceptance = {
			base_assume_debt_condition = {
				base = -50

			}
			condition_two = {
				base = 0
				modifier = {
					add = 5
					is_same_government_THIS_ROOT = yes
				}
				modifier = {
					add = -50
					THIS = { has_government = nationalist }
				}
			}
			condition_three = {
				base = 0
				modifier = {
					add = -10
					THIS = { has_opinion = { target = ROOT value < 0 } }
					THIS = { has_opinion = { target = ROOT value > -25 } }
				}
				modifier = {
					add = -15
					THIS = { has_opinion = { target = ROOT value < -24 } }
					THIS = { has_opinion = { target = ROOT value > -50 } }
				}
				modifier = {
					add = -20
					THIS = { has_opinion = { target = ROOT value < -49 } }
					THIS = { has_opinion = { target = ROOT value > -100 } }
				}
				modifier = {
					add = -30
					THIS = { has_opinion = { target = ROOT value < -99 } }
					THIS = { has_opinion = { target = ROOT value > -150 } }
				}
				modifier = {
					add = -50
					THIS = { has_opinion = { target = ROOT value < -150 } }
				}
				modifier = {
					add = 5
					THIS = { has_opinion = { target = ROOT value > 0 } }
					THIS = { has_opinion = { target = ROOT value < 25 } }
				}
				modifier = {
					add = 10
					THIS = { has_opinion = { target = ROOT value > 24 } }
					THIS = { has_opinion = { target = ROOT value < 50 } }
				}
				modifier = {
					add = 15
					THIS = { has_opinion = { target = ROOT value > 49 } }
					THIS = { has_opinion = { target = ROOT value < 100 } }
				}
				modifier = {
					add = 25
					THIS = { has_opinion = { target = ROOT value > 99 } }
					THIS = { has_opinion = { target = ROOT value < 150 } }
				}
				modifier = {
					add = 30
					THIS = { has_opinion = { target = ROOT value > 149 } }
				}
			}
			condition_four = {
				base = 0
				modifier = {
					ROOT = { has_idea = NATO_member }
					THIS = { has_idea = NATO_member }
					add = 10
				}
			}
			condition_five = {
				base = 0
				modifier = {
					THIS = {
						OR = {
							has_idea = EU_member
							tag = SWI
						}
					}
					ROOT = { has_idea = EU_member }
					add = 15
				}
			}
			condition_six = {
				base = 0
				modifier = {
					ROOT = { is_in_faction_with = PREV }
					add = 10
				}
			}
			condition_seven = {
				base = 0
				modifier = {
					add = 15
					is_subject_of = ROOT
				}
			}
			condition_eight = {
				base = 0
				modifier = {
					add = 5
					is_influencer = yes
				}
			}
			condition_nine = {
				base = 0
				modifier = {
					set_temp_variable = { temp_interest_rate = interest_rate }
					multiply_temp_variable = { temp_interest_rate = 2 }
					check_variable = { temp_interest_rate > 0.8 }
					add = temp_interest_rate
				}
			}
		}

		ai_desire = {
			base = 20
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 49 } }
				add = 2
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 75 } }
				add = 5
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 99 } }
				add = 5
			}
			modifier = {
				ROOT = { is_in_faction_with = PREV }
				add = 2
			}
			modifier = {
				ROOT = { has_idea = EU_member }
				THIS = { has_idea = EU_member }
				add = 2
			}
			modifier = {
				ROOT = { has_idea = NATO_member }
				THIS = { has_idea = NATO_member }
				add = 2
			}
			modifier = {
				ROOT = { is_guaranteed_by = PREV }
				add = 1
			}
			modifier = {
				add = 5
				is_subject_of = ROOT
			}
			modifier = {
				OR = {
					AND = {
						ROOT = { tag = CHI }
						THIS = { tag = USA }
					}
					AND = {
						ROOT = { tag = USA }
						THIS = { tag = CHI }
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = KOR }
					}
					AND = {
						ROOT = { tag = KOR }
						THIS = { tag = NKO }
					}
					AND = {
						ROOT = { tag = JAP }
						THIS = { tag = NKO }
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = JAP }
					}
				}
				factor = 0
			}
			modifier = {
				factor = 0
				OR = {
					AND = {
						ROOT = { has_idea = non_power }
						THIS = { has_idea = non_power }
					}
					AND = {
						ROOT = { has_idea = minor_power }
						THIS = { has_idea = minor_power }
					}
					AND = {
						ROOT = { has_idea = regional_power }
						THIS = { has_idea = regional_power }
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					has_idea = non_power
					has_idea = minor_power
				}
			}
			modifier = {
				factor = 0
				OR = {
					AND = {
						ROOT = { has_idea = regional_power }
						THIS = {
							OR = {
								has_idea = large_power
								has_idea = great_power
								has_idea = superpower
							}
						}
					}
					AND = {
						ROOT = { has_idea = large_power }
						THIS = {
							OR = {
								has_idea = great_power
								has_idea = superpower
							}
						}
					}
					AND = {
						ROOT = { has_idea = great_power }
						THIS = { has_idea = superpower }
					}
				}
			}
			modifier = {
				ROOT = {
					OR = {
						any_enemy_country = {
							is_in_faction_with = PREV.PREV
						}
						any_allied_country = {
							has_war_with = PREV.PREV
						}
					}
				}
				factor = 0
			}
			modifier = {
				factor = 1.25
				ROOT = { has_idea = regional_power }
				THIS = {
					OR = {
						has_idea = minor_power
						has_idea = non_power
					}
				}
			}
			modifier = {
				factor = 1.25
				ROOT = { has_idea = large_power }
				THIS = {
					OR = {
						has_idea = regional_power
						has_idea = minor_power
						has_idea = non_power
					}
				}
			}
			modifier = {
				factor = 1.25
				ROOT = { has_idea = great_power }
				THIS = {
					OR = {
						has_idea = large_power
						has_idea = regional_power
						has_idea = minor_power
						has_idea = non_power
					}
				}
			}
			modifier = {
				factor = 1.25
				ROOT = { has_idea = superpower }
				THIS = {
					OR = {
						has_idea = great_power
						has_idea = large_power
						has_idea = regional_power
						has_idea = minor_power
						has_idea = non_power
					}
				}
			}
			modifier = {
				factor = 0
				ROOT = { check_variable = { interest_rate < 10 } }
			}
			modifier = {
				factor = 1.10
				ROOT = { has_political_power > 499 }
			}
			modifier = {
				factor = 0.50
				ROOT = { has_political_power < 250 }
			}
			modifier = {
				factor = 0
				ROOT = { has_political_power < 150 }
			}
			modifier = {
				factor = 0
				ROOT = {
					NOT = { check_variable = { pending_assume_debt_offer = 0 } }
				}
			}
		}
	}
}
